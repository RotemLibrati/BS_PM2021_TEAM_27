pipeline {
    agent {
        docker { image 'eilonc285/repos-team27:team27' }
    }
    triggers {
      githubPush()
  }

    stages {
        stage('Build') {
          steps {
              sh """
                  cd BS_PM2021_TEAM_27
                  python manage.py makemigrations
                  python manage.py migrate
              """
          }
        }
        stage('Run Unit Tests') {
          steps {
              sh """
                  cd BS_PM2021_TEAM_27
                  python manage.py test >> test_results.txt
              """
          }
        }
        stage('Send Report') {
          steps {
              sh """
                  echo TEST_RESULTS=$(cat test_results.txt)
                  mail bcc: '', body: $TEST_RESULTS, cc: '', from: '', replyTo: '', subject: 'Jenkins update', to: 'eilonco@ac.sce.ac.il'
              """
          }
        }
    }

}
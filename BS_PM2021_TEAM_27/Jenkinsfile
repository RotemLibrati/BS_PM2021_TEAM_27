pipeline {
    agent {
        docker { image 'eilonc285/repos-team27:team27' }
    }
    triggers {
      githubPush()
  }

    stages {
        stage('Build') {
          steps {
              sh """
                  cd BS_PM2021_TEAM_27
                  python manage.py makemigrations
                  python manage.py migrate
                  mail body: 'bod234', subject: 'sub1', to: 'eilonco@ac.sce.ac.il'
              """
          }
        }
        stage('Run Unit Tests') {
          steps {
              sh """
                  cd BS_PM2021_TEAM_27
                  python manage.py test Preschool_Play.tests.TestInboxView.test_with_no_messages >> test_results.txt
              """
          }
        }
    }

}
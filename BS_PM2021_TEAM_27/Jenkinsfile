pipeline {
    agent {
        docker { image 'eilonc285/repos-team27:team27' }
    }
    triggers {
        githubPush()
    }
    stages {
        stage('Build') {
            steps {
                sh """
                    cd BS_PM2021_TEAM_27
                    python manage.py makemigrations
                    python manage.py migrate
                """
            }
        }
        stage('Run Unit Tests') {
            steps {
                script{
                    try{
                        sh """
                        cd BS_PM2021_TEAM_27
                        python manage.py test Preschool_Play.tests.TestInboxView.test_with_no_messages >> test_results.txt
                        """
                    }
                    catch(e){
                        sh "echo '++++++++++++++++++++++++++++++++++'"
                    }
                }
            }
        }
    }
}